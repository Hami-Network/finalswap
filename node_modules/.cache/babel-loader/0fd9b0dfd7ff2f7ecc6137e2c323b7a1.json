{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/97154/swap/hami/LokiswapUI/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/97154/swap/hami/LokiswapUI/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/97154/swap/hami/LokiswapUI/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _taggedTemplateLiteral from\"C:/Users/97154/swap/hami/LokiswapUI/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";var _templateObject;import React,{useState,useCallback}from'react';import styled from'styled-components';import{Button,useModal,IconButton,AddIcon,MinusIcon,Skeleton,Text,Heading}from'@pancakeswap/uikit';import{useLocation}from'react-router-dom';import{BigNumber}from'bignumber.js';import ConnectWalletButton from'components/ConnectWalletButton';import Balance from'components/Balance';import{useWeb3React}from'@web3-react/core';import{useFarmUser,useLpTokenPrice,usePriceCakeBusd}from'state/farms/hooks';import{fetchFarmUserDataAsync}from'state/farms';import{useTranslation}from'contexts/Localization';import{useERC20}from'hooks/useContract';import{BASE_ADD_LIQUIDITY_URL}from'config';import{useAppDispatch}from'state';import{getAddress}from'utils/addressHelpers';import getLiquidityUrlPathParts from'utils/getLiquidityUrlPathParts';import{getBalanceAmount,getBalanceNumber,getFullDisplayBalance}from'utils/formatBalance';import useUnstakeFarms from'../../../hooks/useUnstakeFarms';import DepositModal from'../../DepositModal';import WithdrawModal from'../../WithdrawModal';import useStakeFarms from'../../../hooks/useStakeFarms';import useApproveFarm from'../../../hooks/useApproveFarm';import{ActionContainer,ActionTitles,ActionContent}from'./styles';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var IconButtonWrapper=styled.div(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  display: flex;\\n\"])));var Staked=function Staked(_ref){var pid=_ref.pid,apr=_ref.apr,multiplier=_ref.multiplier,lpSymbol=_ref.lpSymbol,lpLabel=_ref.lpLabel,lpAddresses=_ref.lpAddresses,quoteToken=_ref.quoteToken,token=_ref.token,userDataReady=_ref.userDataReady,displayApr=_ref.displayApr,isTokenOnly=_ref.isTokenOnly,decimals=_ref.decimals;var _useTranslation=useTranslation(),t=_useTranslation.t;var _useWeb3React=useWeb3React(),account=_useWeb3React.account;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),requestedApproval=_useState2[0],setRequestedApproval=_useState2[1];var _useFarmUser=useFarmUser(pid),allowance=_useFarmUser.allowance,tokenBalance=_useFarmUser.tokenBalance,stakedBalance=_useFarmUser.stakedBalance;var _useStakeFarms=useStakeFarms(pid),onStake=_useStakeFarms.onStake;var _useUnstakeFarms=useUnstakeFarms(pid),onUnstake=_useUnstakeFarms.onUnstake;var location=useLocation();var lpPrice=useLpTokenPrice(lpSymbol,isTokenOnly);var cakePrice=usePriceCakeBusd();var isApproved=account&&allowance&&allowance.isGreaterThan(0);var lpAddress=isTokenOnly?getAddress(token.address):getAddress(lpAddresses);var liquidityUrlPathParts=getLiquidityUrlPathParts({quoteTokenAddress:quoteToken.address,tokenAddress:token.address});var addLiquidityUrl=\"\".concat(BASE_ADD_LIQUIDITY_URL,\"/\").concat(liquidityUrlPathParts);var handleStake=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(amount){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return onStake(amount,decimals);case 2:dispatch(fetchFarmUserDataAsync({account:account,pids:[pid]}));case 3:case\"end\":return _context.stop();}}},_callee);}));return function handleStake(_x){return _ref2.apply(this,arguments);};}();var handleUnstake=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(amount){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return onUnstake(amount,decimals);case 2:dispatch(fetchFarmUserDataAsync({account:account,pids:[pid]}));case 3:case\"end\":return _context2.stop();}}},_callee2);}));return function handleUnstake(_x2){return _ref3.apply(this,arguments);};}();var displayBalance=useCallback(function(){var stakedBalanceBigNumber=getBalanceAmount(stakedBalance,decimals);if(stakedBalanceBigNumber.gt(0)&&stakedBalanceBigNumber.lt(0.0000001)){return stakedBalanceBigNumber.toFixed(10,BigNumber.ROUND_DOWN);}if(stakedBalanceBigNumber.gt(0)&&stakedBalanceBigNumber.lt(0.0001)){return getFullDisplayBalance(stakedBalance,decimals).toLocaleString();}return stakedBalanceBigNumber.toFixed(3,BigNumber.ROUND_DOWN);},[stakedBalance,decimals]);var _useModal=useModal(/*#__PURE__*/_jsx(DepositModal,{max:tokenBalance,lpPrice:lpPrice,lpLabel:lpLabel,apr:apr,displayApr:displayApr,stakedBalance:stakedBalance,onConfirm:handleStake,tokenName:lpSymbol,multiplier:multiplier,addLiquidityUrl:addLiquidityUrl,cakePrice:cakePrice,isTokenOnly:isTokenOnly,decimals:decimals})),_useModal2=_slicedToArray(_useModal,1),onPresentDeposit=_useModal2[0];var _useModal3=useModal(/*#__PURE__*/_jsx(WithdrawModal,{max:stakedBalance,onConfirm:handleUnstake,tokenName:lpSymbol,isTokenOnly:isTokenOnly,decimals:decimals})),_useModal4=_slicedToArray(_useModal3,1),onPresentWithdraw=_useModal4[0];var lpContract=useERC20(lpAddress);var dispatch=useAppDispatch();var _useApproveFarm=useApproveFarm(lpContract),onApprove=_useApproveFarm.onApprove;var handleApprove=useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;setRequestedApproval(true);_context3.next=4;return onApprove();case 4:dispatch(fetchFarmUserDataAsync({account:account,pids:[pid]}));setRequestedApproval(false);_context3.next=11;break;case 8:_context3.prev=8;_context3.t0=_context3[\"catch\"](0);console.error(_context3.t0);case 11:case\"end\":return _context3.stop();}}},_callee3,null,[[0,8]]);})),[onApprove,dispatch,account,pid]);if(!account){return/*#__PURE__*/_jsxs(ActionContainer,{children:[/*#__PURE__*/_jsx(ActionTitles,{children:/*#__PURE__*/_jsx(Text,{bold:true,textTransform:\"uppercase\",color:\"textSubtle\",fontSize:\"12px\",children:t('Start Farming')})}),/*#__PURE__*/_jsx(ActionContent,{children:/*#__PURE__*/_jsx(ConnectWalletButton,{width:\"100%\"})})]});}if(isApproved){if(stakedBalance.gt(0)){return/*#__PURE__*/_jsxs(ActionContainer,{children:[/*#__PURE__*/_jsxs(ActionTitles,{children:[/*#__PURE__*/_jsx(Text,{bold:true,textTransform:\"uppercase\",color:\"secondary\",fontSize:\"12px\",pr:\"4px\",children:lpSymbol}),/*#__PURE__*/_jsx(Text,{bold:true,textTransform:\"uppercase\",color:\"textSubtle\",fontSize:\"12px\",children:t('Staked')})]}),/*#__PURE__*/_jsxs(ActionContent,{children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Heading,{children:displayBalance()}),stakedBalance.gt(0)&&lpPrice.gt(0)&&/*#__PURE__*/_jsx(Balance,{fontSize:\"12px\",color:\"textSubtle\",decimals:2,value:getBalanceNumber(lpPrice.times(stakedBalance),decimals),unit:\" USD\",prefix:\"~\"})]}),/*#__PURE__*/_jsxs(IconButtonWrapper,{children:[/*#__PURE__*/_jsx(IconButton,{variant:\"secondary\",onClick:onPresentWithdraw,mr:\"6px\",children:/*#__PURE__*/_jsx(MinusIcon,{color:\"primary\",width:\"14px\"})}),/*#__PURE__*/_jsx(IconButton,{variant:\"secondary\",onClick:onPresentDeposit,disabled:['history','archived'].some(function(item){return location.pathname.includes(item);}),children:/*#__PURE__*/_jsx(AddIcon,{color:\"primary\",width:\"14px\"})})]})]})]});}return/*#__PURE__*/_jsxs(ActionContainer,{children:[/*#__PURE__*/_jsxs(ActionTitles,{children:[/*#__PURE__*/_jsx(Text,{bold:true,textTransform:\"uppercase\",color:\"textSubtle\",fontSize:\"12px\",pr:\"4px\",children:t('Stake').toUpperCase()}),/*#__PURE__*/_jsx(Text,{bold:true,textTransform:\"uppercase\",color:\"secondary\",fontSize:\"12px\",children:lpSymbol})]}),/*#__PURE__*/_jsx(ActionContent,{children:/*#__PURE__*/_jsx(Button,{width:\"100%\",onClick:onPresentDeposit,variant:\"secondary\",disabled:['history','archived'].some(function(item){return location.pathname.includes(item);}),children:isTokenOnly?t('Stake'):t('Stake LP')})})]});}if(!userDataReady){return/*#__PURE__*/_jsxs(ActionContainer,{children:[/*#__PURE__*/_jsx(ActionTitles,{children:/*#__PURE__*/_jsx(Text,{bold:true,textTransform:\"uppercase\",color:\"textSubtle\",fontSize:\"12px\",children:t('Start Farming')})}),/*#__PURE__*/_jsx(ActionContent,{children:/*#__PURE__*/_jsx(Skeleton,{width:180,marginBottom:28,marginTop:14})})]});}return/*#__PURE__*/_jsxs(ActionContainer,{children:[/*#__PURE__*/_jsx(ActionTitles,{children:/*#__PURE__*/_jsx(Text,{bold:true,textTransform:\"uppercase\",color:\"textSubtle\",fontSize:\"12px\",children:t('Enable Farm')})}),/*#__PURE__*/_jsx(ActionContent,{children:/*#__PURE__*/_jsx(Button,{width:\"100%\",disabled:requestedApproval,onClick:handleApprove,variant:\"secondary\",children:t('Enable')})})]});};export default Staked;","map":{"version":3,"sources":["C:/Users/97154/swap/hami/LokiswapUI/src/views/Farms/components/FarmTable/Actions/StakedAction.tsx"],"names":["React","useState","useCallback","styled","Button","useModal","IconButton","AddIcon","MinusIcon","Skeleton","Text","Heading","useLocation","BigNumber","ConnectWalletButton","Balance","useWeb3React","useFarmUser","useLpTokenPrice","usePriceCakeBusd","fetchFarmUserDataAsync","useTranslation","useERC20","BASE_ADD_LIQUIDITY_URL","useAppDispatch","getAddress","getLiquidityUrlPathParts","getBalanceAmount","getBalanceNumber","getFullDisplayBalance","useUnstakeFarms","DepositModal","WithdrawModal","useStakeFarms","useApproveFarm","ActionContainer","ActionTitles","ActionContent","IconButtonWrapper","div","Staked","pid","apr","multiplier","lpSymbol","lpLabel","lpAddresses","quoteToken","token","userDataReady","displayApr","isTokenOnly","decimals","t","account","requestedApproval","setRequestedApproval","allowance","tokenBalance","stakedBalance","onStake","onUnstake","location","lpPrice","cakePrice","isApproved","isGreaterThan","lpAddress","address","liquidityUrlPathParts","quoteTokenAddress","tokenAddress","addLiquidityUrl","handleStake","amount","dispatch","pids","handleUnstake","displayBalance","stakedBalanceBigNumber","gt","lt","toFixed","ROUND_DOWN","toLocaleString","onPresentDeposit","onPresentWithdraw","lpContract","onApprove","handleApprove","console","error","times","some","item","pathname","includes","toUpperCase"],"mappings":"yoBAAA,MAAOA,CAAAA,KAAP,EAAgBC,QAAhB,CAA0BC,WAA1B,KAA6C,OAA7C,CACA,MAAOC,CAAAA,MAAP,KAAmB,mBAAnB,CACA,OAASC,MAAT,CAAiBC,QAAjB,CAA2BC,UAA3B,CAAuCC,OAAvC,CAAgDC,SAAhD,CAA2DC,QAA3D,CAAqEC,IAArE,CAA2EC,OAA3E,KAA0F,oBAA1F,CACA,OAASC,WAAT,KAA4B,kBAA5B,CACA,OAASC,SAAT,KAA0B,cAA1B,CACA,MAAOC,CAAAA,mBAAP,KAAgC,gCAAhC,CACA,MAAOC,CAAAA,OAAP,KAAoB,oBAApB,CACA,OAASC,YAAT,KAA6B,kBAA7B,CACA,OAASC,WAAT,CAAsBC,eAAtB,CAAuCC,gBAAvC,KAA+D,mBAA/D,CACA,OAASC,sBAAT,KAAuC,aAAvC,CAEA,OAASC,cAAT,KAA+B,uBAA/B,CACA,OAASC,QAAT,KAAyB,mBAAzB,CACA,OAASC,sBAAT,KAAuC,QAAvC,CACA,OAASC,cAAT,KAA+B,OAA/B,CACA,OAASC,UAAT,KAA2B,sBAA3B,CACA,MAAOC,CAAAA,wBAAP,KAAqC,gCAArC,CACA,OAASC,gBAAT,CAA2BC,gBAA3B,CAA6CC,qBAA7C,KAA0E,qBAA1E,CACA,MAAOC,CAAAA,eAAP,KAA4B,gCAA5B,CACA,MAAOC,CAAAA,YAAP,KAAyB,oBAAzB,CACA,MAAOC,CAAAA,aAAP,KAA0B,qBAA1B,CACA,MAAOC,CAAAA,aAAP,KAA0B,8BAA1B,CACA,MAAOC,CAAAA,cAAP,KAA2B,+BAA3B,CACA,OAASC,eAAT,CAA0BC,YAA1B,CAAwCC,aAAxC,KAA6D,UAA7D,C,wFAEA,GAAMC,CAAAA,iBAAiB,CAAGnC,MAAM,CAACoC,GAAV,qFAAvB,CAWA,GAAMC,CAAAA,MAAmD,CAAG,QAAtDA,CAAAA,MAAsD,MAatD,IAZJC,CAAAA,GAYI,MAZJA,GAYI,CAXJC,GAWI,MAXJA,GAWI,CAVJC,UAUI,MAVJA,UAUI,CATJC,QASI,MATJA,QASI,CARJC,OAQI,MARJA,OAQI,CAPJC,WAOI,MAPJA,WAOI,CANJC,UAMI,MANJA,UAMI,CALJC,KAKI,MALJA,KAKI,CAJJC,aAII,MAJJA,aAII,CAHJC,UAGI,MAHJA,UAGI,CAFJC,WAEI,MAFJA,WAEI,CADJC,QACI,MADJA,QACI,CACJ,oBAAc/B,cAAc,EAA5B,CAAQgC,CAAR,iBAAQA,CAAR,CACA,kBAAoBrC,YAAY,EAAhC,CAAQsC,OAAR,eAAQA,OAAR,CACA,cAAkDrD,QAAQ,CAAC,KAAD,CAA1D,wCAAOsD,iBAAP,eAA0BC,oBAA1B,eACA,iBAAmDvC,WAAW,CAACwB,GAAD,CAA9D,CAAQgB,SAAR,cAAQA,SAAR,CAAmBC,YAAnB,cAAmBA,YAAnB,CAAiCC,aAAjC,cAAiCA,aAAjC,CACA,mBAAoB1B,aAAa,CAACQ,GAAD,CAAjC,CAAQmB,OAAR,gBAAQA,OAAR,CACA,qBAAsB9B,eAAe,CAACW,GAAD,CAArC,CAAQoB,SAAR,kBAAQA,SAAR,CACA,GAAMC,CAAAA,QAAQ,CAAGlD,WAAW,EAA5B,CACA,GAAMmD,CAAAA,OAAO,CAAG7C,eAAe,CAAC0B,QAAD,CAAWO,WAAX,CAA/B,CACA,GAAMa,CAAAA,SAAS,CAAG7C,gBAAgB,EAAlC,CAEA,GAAM8C,CAAAA,UAAU,CAAGX,OAAO,EAAIG,SAAX,EAAwBA,SAAS,CAACS,aAAV,CAAwB,CAAxB,CAA3C,CAEA,GAAMC,CAAAA,SAAS,CAAGhB,WAAW,CAAG1B,UAAU,CAACuB,KAAK,CAACoB,OAAP,CAAb,CAA+B3C,UAAU,CAACqB,WAAD,CAAtE,CACA,GAAMuB,CAAAA,qBAAqB,CAAG3C,wBAAwB,CAAC,CACrD4C,iBAAiB,CAAEvB,UAAU,CAACqB,OADuB,CAErDG,YAAY,CAAEvB,KAAK,CAACoB,OAFiC,CAAD,CAAtD,CAIA,GAAMI,CAAAA,eAAe,WAAMjD,sBAAN,aAAgC8C,qBAAhC,CAArB,CAEA,GAAMI,CAAAA,WAAW,2FAAG,iBAAOC,MAAP,wIACZd,CAAAA,OAAO,CAACc,MAAD,CAAStB,QAAT,CADK,QAElBuB,QAAQ,CAACvD,sBAAsB,CAAC,CAAEkC,OAAO,CAAPA,OAAF,CAAWsB,IAAI,CAAE,CAACnC,GAAD,CAAjB,CAAD,CAAvB,CAAR,CAFkB,sDAAH,kBAAXgC,CAAAA,WAAW,6CAAjB,CAKA,GAAMI,CAAAA,aAAa,2FAAG,kBAAOH,MAAP,6IACdb,CAAAA,SAAS,CAACa,MAAD,CAAStB,QAAT,CADK,QAEpBuB,QAAQ,CAACvD,sBAAsB,CAAC,CAAEkC,OAAO,CAAPA,OAAF,CAAWsB,IAAI,CAAE,CAACnC,GAAD,CAAjB,CAAD,CAAvB,CAAR,CAFoB,wDAAH,kBAAboC,CAAAA,aAAa,8CAAnB,CAKA,GAAMC,CAAAA,cAAc,CAAG5E,WAAW,CAAC,UAAM,CACvC,GAAM6E,CAAAA,sBAAsB,CAAGpD,gBAAgB,CAACgC,aAAD,CAAgBP,QAAhB,CAA/C,CACA,GAAI2B,sBAAsB,CAACC,EAAvB,CAA0B,CAA1B,GAAgCD,sBAAsB,CAACE,EAAvB,CAA0B,SAA1B,CAApC,CAA0E,CACxE,MAAOF,CAAAA,sBAAsB,CAACG,OAAvB,CAA+B,EAA/B,CAAmCrE,SAAS,CAACsE,UAA7C,CAAP,CACD,CACD,GAAIJ,sBAAsB,CAACC,EAAvB,CAA0B,CAA1B,GAAgCD,sBAAsB,CAACE,EAAvB,CAA0B,MAA1B,CAApC,CAAuE,CACrE,MAAOpD,CAAAA,qBAAqB,CAAC8B,aAAD,CAAgBP,QAAhB,CAArB,CAA+CgC,cAA/C,EAAP,CACD,CACD,MAAOL,CAAAA,sBAAsB,CAACG,OAAvB,CAA+B,CAA/B,CAAkCrE,SAAS,CAACsE,UAA5C,CAAP,CACD,CATiC,CAS/B,CAACxB,aAAD,CAAgBP,QAAhB,CAT+B,CAAlC,CAWA,cAA2B/C,QAAQ,cACjC,KAAC,YAAD,EACE,GAAG,CAAEqD,YADP,CAEE,OAAO,CAAEK,OAFX,CAGE,OAAO,CAAElB,OAHX,CAIE,GAAG,CAAEH,GAJP,CAKE,UAAU,CAAEQ,UALd,CAME,aAAa,CAAES,aANjB,CAOE,SAAS,CAAEc,WAPb,CAQE,SAAS,CAAE7B,QARb,CASE,UAAU,CAAED,UATd,CAUE,eAAe,CAAE6B,eAVnB,CAWE,SAAS,CAAER,SAXb,CAYE,WAAW,CAAEb,WAZf,CAaE,QAAQ,CAAEC,QAbZ,EADiC,CAAnC,wCAAOiC,gBAAP,eAiBA,eAA4BhF,QAAQ,cAClC,KAAC,aAAD,EAAe,GAAG,CAAEsD,aAApB,CAAmC,SAAS,CAAEkB,aAA9C,CAA6D,SAAS,CAAEjC,QAAxE,CAAkF,WAAW,CAAEO,WAA/F,CAA4G,QAAQ,CAAEC,QAAtH,EADkC,CAApC,yCAAOkC,iBAAP,eAGA,GAAMC,CAAAA,UAAU,CAAGjE,QAAQ,CAAC6C,SAAD,CAA3B,CACA,GAAMQ,CAAAA,QAAQ,CAAGnD,cAAc,EAA/B,CACA,oBAAsBU,cAAc,CAACqD,UAAD,CAApC,CAAQC,SAAR,iBAAQA,SAAR,CAEA,GAAMC,CAAAA,aAAa,CAAGvF,WAAW,sEAAC,yJAE9BsD,oBAAoB,CAAC,IAAD,CAApB,CAF8B,uBAGxBgC,CAAAA,SAAS,EAHe,QAI9Bb,QAAQ,CAACvD,sBAAsB,CAAC,CAAEkC,OAAO,CAAPA,OAAF,CAAWsB,IAAI,CAAE,CAACnC,GAAD,CAAjB,CAAD,CAAvB,CAAR,CAEAe,oBAAoB,CAAC,KAAD,CAApB,CAN8B,mFAQ9BkC,OAAO,CAACC,KAAR,eAR8B,sEAAD,GAU9B,CAACH,SAAD,CAAYb,QAAZ,CAAsBrB,OAAtB,CAA+Bb,GAA/B,CAV8B,CAAjC,CAYA,GAAI,CAACa,OAAL,CAAc,CACZ,mBACE,MAAC,eAAD,yBACE,KAAC,YAAD,wBACE,KAAC,IAAD,EAAM,IAAI,KAAV,CAAW,aAAa,CAAC,WAAzB,CAAqC,KAAK,CAAC,YAA3C,CAAwD,QAAQ,CAAC,MAAjE,UACGD,CAAC,CAAC,eAAD,CADJ,EADF,EADF,cAME,KAAC,aAAD,wBACE,KAAC,mBAAD,EAAqB,KAAK,CAAC,MAA3B,EADF,EANF,GADF,CAYD,CAED,GAAIY,UAAJ,CAAgB,CACd,GAAIN,aAAa,CAACqB,EAAd,CAAiB,CAAjB,CAAJ,CAAyB,CACvB,mBACE,MAAC,eAAD,yBACE,MAAC,YAAD,yBACE,KAAC,IAAD,EAAM,IAAI,KAAV,CAAW,aAAa,CAAC,WAAzB,CAAqC,KAAK,CAAC,WAA3C,CAAuD,QAAQ,CAAC,MAAhE,CAAuE,EAAE,CAAC,KAA1E,UACGpC,QADH,EADF,cAIE,KAAC,IAAD,EAAM,IAAI,KAAV,CAAW,aAAa,CAAC,WAAzB,CAAqC,KAAK,CAAC,YAA3C,CAAwD,QAAQ,CAAC,MAAjE,UACGS,CAAC,CAAC,QAAD,CADJ,EAJF,GADF,cASE,MAAC,aAAD,yBACE,oCACE,KAAC,OAAD,WAAUyB,cAAc,EAAxB,EADF,CAEGnB,aAAa,CAACqB,EAAd,CAAiB,CAAjB,GAAuBjB,OAAO,CAACiB,EAAR,CAAW,CAAX,CAAvB,eACC,KAAC,OAAD,EACE,QAAQ,CAAC,MADX,CAEE,KAAK,CAAC,YAFR,CAGE,QAAQ,CAAE,CAHZ,CAIE,KAAK,CAAEpD,gBAAgB,CAACmC,OAAO,CAAC6B,KAAR,CAAcjC,aAAd,CAAD,CAA+BP,QAA/B,CAJzB,CAKE,IAAI,CAAC,MALP,CAME,MAAM,CAAC,GANT,EAHJ,GADF,cAcE,MAAC,iBAAD,yBACE,KAAC,UAAD,EAAY,OAAO,CAAC,WAApB,CAAgC,OAAO,CAAEkC,iBAAzC,CAA4D,EAAE,CAAC,KAA/D,uBACE,KAAC,SAAD,EAAW,KAAK,CAAC,SAAjB,CAA2B,KAAK,CAAC,MAAjC,EADF,EADF,cAIE,KAAC,UAAD,EACE,OAAO,CAAC,WADV,CAEE,OAAO,CAAED,gBAFX,CAGE,QAAQ,CAAE,CAAC,SAAD,CAAY,UAAZ,EAAwBQ,IAAxB,CAA6B,SAACC,IAAD,QAAUhC,CAAAA,QAAQ,CAACiC,QAAT,CAAkBC,QAAlB,CAA2BF,IAA3B,CAAV,EAA7B,CAHZ,uBAKE,KAAC,OAAD,EAAS,KAAK,CAAC,SAAf,CAAyB,KAAK,CAAC,MAA/B,EALF,EAJF,GAdF,GATF,GADF,CAuCD,CAED,mBACE,MAAC,eAAD,yBACE,MAAC,YAAD,yBACE,KAAC,IAAD,EAAM,IAAI,KAAV,CAAW,aAAa,CAAC,WAAzB,CAAqC,KAAK,CAAC,YAA3C,CAAwD,QAAQ,CAAC,MAAjE,CAAwE,EAAE,CAAC,KAA3E,UACGzC,CAAC,CAAC,OAAD,CAAD,CAAW4C,WAAX,EADH,EADF,cAIE,KAAC,IAAD,EAAM,IAAI,KAAV,CAAW,aAAa,CAAC,WAAzB,CAAqC,KAAK,CAAC,WAA3C,CAAuD,QAAQ,CAAC,MAAhE,UACGrD,QADH,EAJF,GADF,cASE,KAAC,aAAD,wBACE,KAAC,MAAD,EACE,KAAK,CAAC,MADR,CAEE,OAAO,CAAEyC,gBAFX,CAGE,OAAO,CAAC,WAHV,CAIE,QAAQ,CAAE,CAAC,SAAD,CAAY,UAAZ,EAAwBQ,IAAxB,CAA6B,SAACC,IAAD,QAAUhC,CAAAA,QAAQ,CAACiC,QAAT,CAAkBC,QAAlB,CAA2BF,IAA3B,CAAV,EAA7B,CAJZ,UAMG3C,WAAW,CAAGE,CAAC,CAAC,OAAD,CAAJ,CAAgBA,CAAC,CAAC,UAAD,CAN/B,EADF,EATF,GADF,CAsBD,CAED,GAAI,CAACJ,aAAL,CAAoB,CAClB,mBACE,MAAC,eAAD,yBACE,KAAC,YAAD,wBACE,KAAC,IAAD,EAAM,IAAI,KAAV,CAAW,aAAa,CAAC,WAAzB,CAAqC,KAAK,CAAC,YAA3C,CAAwD,QAAQ,CAAC,MAAjE,UACGI,CAAC,CAAC,eAAD,CADJ,EADF,EADF,cAME,KAAC,aAAD,wBACE,KAAC,QAAD,EAAU,KAAK,CAAE,GAAjB,CAAsB,YAAY,CAAE,EAApC,CAAwC,SAAS,CAAE,EAAnD,EADF,EANF,GADF,CAYD,CAED,mBACE,MAAC,eAAD,yBACE,KAAC,YAAD,wBACE,KAAC,IAAD,EAAM,IAAI,KAAV,CAAW,aAAa,CAAC,WAAzB,CAAqC,KAAK,CAAC,YAA3C,CAAwD,QAAQ,CAAC,MAAjE,UACGA,CAAC,CAAC,aAAD,CADJ,EADF,EADF,cAME,KAAC,aAAD,wBACE,KAAC,MAAD,EAAQ,KAAK,CAAC,MAAd,CAAqB,QAAQ,CAAEE,iBAA/B,CAAkD,OAAO,CAAEkC,aAA3D,CAA0E,OAAO,CAAC,WAAlF,UACGpC,CAAC,CAAC,QAAD,CADJ,EADF,EANF,GADF,CAcD,CAzMD,CA2MA,cAAeb,CAAAA,MAAf","sourcesContent":["import React, { useState, useCallback } from 'react'\r\nimport styled from 'styled-components'\r\nimport { Button, useModal, IconButton, AddIcon, MinusIcon, Skeleton, Text, Heading } from '@pancakeswap/uikit'\r\nimport { useLocation } from 'react-router-dom'\r\nimport { BigNumber } from 'bignumber.js'\r\nimport ConnectWalletButton from 'components/ConnectWalletButton'\r\nimport Balance from 'components/Balance'\r\nimport { useWeb3React } from '@web3-react/core'\r\nimport { useFarmUser, useLpTokenPrice, usePriceCakeBusd } from 'state/farms/hooks'\r\nimport { fetchFarmUserDataAsync } from 'state/farms'\r\nimport { FarmWithStakedValue } from 'views/Farms/components/FarmCard/FarmCard'\r\nimport { useTranslation } from 'contexts/Localization'\r\nimport { useERC20 } from 'hooks/useContract'\r\nimport { BASE_ADD_LIQUIDITY_URL } from 'config'\r\nimport { useAppDispatch } from 'state'\r\nimport { getAddress } from 'utils/addressHelpers'\r\nimport getLiquidityUrlPathParts from 'utils/getLiquidityUrlPathParts'\r\nimport { getBalanceAmount, getBalanceNumber, getFullDisplayBalance } from 'utils/formatBalance'\r\nimport useUnstakeFarms from '../../../hooks/useUnstakeFarms'\r\nimport DepositModal from '../../DepositModal'\r\nimport WithdrawModal from '../../WithdrawModal'\r\nimport useStakeFarms from '../../../hooks/useStakeFarms'\r\nimport useApproveFarm from '../../../hooks/useApproveFarm'\r\nimport { ActionContainer, ActionTitles, ActionContent } from './styles'\r\n\r\nconst IconButtonWrapper = styled.div`\r\n  display: flex;\r\n`\r\n\r\ninterface StackedActionProps extends FarmWithStakedValue {\r\n  userDataReady: boolean\r\n  lpLabel?: string\r\n  displayApr?: string\r\n  decimals?: number\r\n}\r\n\r\nconst Staked: React.FunctionComponent<StackedActionProps> = ({\r\n  pid,\r\n  apr,\r\n  multiplier,\r\n  lpSymbol,\r\n  lpLabel,\r\n  lpAddresses,\r\n  quoteToken,\r\n  token,\r\n  userDataReady,\r\n  displayApr,\r\n  isTokenOnly,\r\n  decimals\r\n}) => {\r\n  const { t } = useTranslation()\r\n  const { account } = useWeb3React()\r\n  const [requestedApproval, setRequestedApproval] = useState(false)\r\n  const { allowance, tokenBalance, stakedBalance } = useFarmUser(pid)\r\n  const { onStake } = useStakeFarms(pid)\r\n  const { onUnstake } = useUnstakeFarms(pid)\r\n  const location = useLocation()\r\n  const lpPrice = useLpTokenPrice(lpSymbol, isTokenOnly)\r\n  const cakePrice = usePriceCakeBusd()\r\n\r\n  const isApproved = account && allowance && allowance.isGreaterThan(0)\r\n\r\n  const lpAddress = isTokenOnly ? getAddress(token.address) : getAddress(lpAddresses)\r\n  const liquidityUrlPathParts = getLiquidityUrlPathParts({\r\n    quoteTokenAddress: quoteToken.address,\r\n    tokenAddress: token.address,\r\n  })\r\n  const addLiquidityUrl = `${BASE_ADD_LIQUIDITY_URL}/${liquidityUrlPathParts}`\r\n\r\n  const handleStake = async (amount: string) => {\r\n    await onStake(amount, decimals)\r\n    dispatch(fetchFarmUserDataAsync({ account, pids: [pid] }))\r\n  }\r\n\r\n  const handleUnstake = async (amount: string) => {\r\n    await onUnstake(amount, decimals)\r\n    dispatch(fetchFarmUserDataAsync({ account, pids: [pid] }))\r\n  }\r\n\r\n  const displayBalance = useCallback(() => {\r\n    const stakedBalanceBigNumber = getBalanceAmount(stakedBalance, decimals)\r\n    if (stakedBalanceBigNumber.gt(0) && stakedBalanceBigNumber.lt(0.0000001)) {\r\n      return stakedBalanceBigNumber.toFixed(10, BigNumber.ROUND_DOWN)\r\n    }\r\n    if (stakedBalanceBigNumber.gt(0) && stakedBalanceBigNumber.lt(0.0001)) {\r\n      return getFullDisplayBalance(stakedBalance, decimals).toLocaleString()\r\n    }\r\n    return stakedBalanceBigNumber.toFixed(3, BigNumber.ROUND_DOWN)\r\n  }, [stakedBalance, decimals])\r\n\r\n  const [onPresentDeposit] = useModal(\r\n    <DepositModal\r\n      max={tokenBalance}\r\n      lpPrice={lpPrice}\r\n      lpLabel={lpLabel}\r\n      apr={apr}\r\n      displayApr={displayApr}\r\n      stakedBalance={stakedBalance}\r\n      onConfirm={handleStake}\r\n      tokenName={lpSymbol}\r\n      multiplier={multiplier}\r\n      addLiquidityUrl={addLiquidityUrl}\r\n      cakePrice={cakePrice}\r\n      isTokenOnly={isTokenOnly}\r\n      decimals={decimals}\r\n    />,\r\n  )\r\n  const [onPresentWithdraw] = useModal(\r\n    <WithdrawModal max={stakedBalance} onConfirm={handleUnstake} tokenName={lpSymbol} isTokenOnly={isTokenOnly} decimals={decimals}/>,\r\n  )\r\n  const lpContract = useERC20(lpAddress)\r\n  const dispatch = useAppDispatch()\r\n  const { onApprove } = useApproveFarm(lpContract)\r\n\r\n  const handleApprove = useCallback(async () => {\r\n    try {\r\n      setRequestedApproval(true)\r\n      await onApprove()\r\n      dispatch(fetchFarmUserDataAsync({ account, pids: [pid] }))\r\n\r\n      setRequestedApproval(false)\r\n    } catch (e) {\r\n      console.error(e)\r\n    }\r\n  }, [onApprove, dispatch, account, pid])\r\n\r\n  if (!account) {\r\n    return (\r\n      <ActionContainer>\r\n        <ActionTitles>\r\n          <Text bold textTransform=\"uppercase\" color=\"textSubtle\" fontSize=\"12px\">\r\n            {t('Start Farming')}\r\n          </Text>\r\n        </ActionTitles>\r\n        <ActionContent>\r\n          <ConnectWalletButton width=\"100%\" />\r\n        </ActionContent>\r\n      </ActionContainer>\r\n    )\r\n  }\r\n\r\n  if (isApproved) {\r\n    if (stakedBalance.gt(0)) {\r\n      return (\r\n        <ActionContainer>\r\n          <ActionTitles>\r\n            <Text bold textTransform=\"uppercase\" color=\"secondary\" fontSize=\"12px\" pr=\"4px\">\r\n              {lpSymbol}\r\n            </Text>\r\n            <Text bold textTransform=\"uppercase\" color=\"textSubtle\" fontSize=\"12px\">\r\n              {t('Staked')}\r\n            </Text>\r\n          </ActionTitles>\r\n          <ActionContent>\r\n            <div>\r\n              <Heading>{displayBalance()}</Heading>\r\n              {stakedBalance.gt(0) && lpPrice.gt(0) && (\r\n                <Balance\r\n                  fontSize=\"12px\"\r\n                  color=\"textSubtle\"\r\n                  decimals={2}\r\n                  value={getBalanceNumber(lpPrice.times(stakedBalance), decimals)}\r\n                  unit=\" USD\"\r\n                  prefix=\"~\"\r\n                />\r\n              )}\r\n            </div>\r\n            <IconButtonWrapper>\r\n              <IconButton variant=\"secondary\" onClick={onPresentWithdraw} mr=\"6px\">\r\n                <MinusIcon color=\"primary\" width=\"14px\" />\r\n              </IconButton>\r\n              <IconButton\r\n                variant=\"secondary\"\r\n                onClick={onPresentDeposit}\r\n                disabled={['history', 'archived'].some((item) => location.pathname.includes(item))}\r\n              >\r\n                <AddIcon color=\"primary\" width=\"14px\" />\r\n              </IconButton>\r\n            </IconButtonWrapper>\r\n          </ActionContent>\r\n        </ActionContainer>\r\n      )\r\n    }\r\n\r\n    return (\r\n      <ActionContainer>\r\n        <ActionTitles>\r\n          <Text bold textTransform=\"uppercase\" color=\"textSubtle\" fontSize=\"12px\" pr=\"4px\">\r\n            {t('Stake').toUpperCase()}\r\n          </Text>\r\n          <Text bold textTransform=\"uppercase\" color=\"secondary\" fontSize=\"12px\">\r\n            {lpSymbol}\r\n          </Text>\r\n        </ActionTitles>\r\n        <ActionContent>\r\n          <Button\r\n            width=\"100%\"\r\n            onClick={onPresentDeposit}\r\n            variant=\"secondary\"\r\n            disabled={['history', 'archived'].some((item) => location.pathname.includes(item))}\r\n          >\r\n            {isTokenOnly ? t('Stake') : t('Stake LP')}\r\n          </Button>\r\n        </ActionContent>\r\n      </ActionContainer>\r\n    )\r\n  }\r\n\r\n  if (!userDataReady) {\r\n    return (\r\n      <ActionContainer>\r\n        <ActionTitles>\r\n          <Text bold textTransform=\"uppercase\" color=\"textSubtle\" fontSize=\"12px\">\r\n            {t('Start Farming')}\r\n          </Text>\r\n        </ActionTitles>\r\n        <ActionContent>\r\n          <Skeleton width={180} marginBottom={28} marginTop={14} />\r\n        </ActionContent>\r\n      </ActionContainer>\r\n    )\r\n  }\r\n\r\n  return (\r\n    <ActionContainer>\r\n      <ActionTitles>\r\n        <Text bold textTransform=\"uppercase\" color=\"textSubtle\" fontSize=\"12px\">\r\n          {t('Enable Farm')}\r\n        </Text>\r\n      </ActionTitles>\r\n      <ActionContent>\r\n        <Button width=\"100%\" disabled={requestedApproval} onClick={handleApprove} variant=\"secondary\">\r\n          {t('Enable')}\r\n        </Button>\r\n      </ActionContent>\r\n    </ActionContainer>\r\n  )\r\n}\r\n\r\nexport default Staked\r\n"]},"metadata":{},"sourceType":"module"}